<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    width: 760px; min-height: 200px; max-height: 600px; overflow-y: auto;
    background: #020617; color: #e2e8f0;
    font-family: 'JetBrains Mono', monospace; font-size: 12px;
  }
  .container { padding: 16px 18px 20px; }
  .header { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
  .header-bar { width: 6px; height: 24px; background: linear-gradient(to bottom, #3b82f6, #8b5cf6); border-radius: 2px; flex-shrink: 0; }
  .header h1 { font-size: 15px; font-weight: 700; color: #f8fafc; letter-spacing: -0.3px; }
  .subtitle { font-size: 11px; color: #475569; margin: 0 0 14px 16px; }
  .tabs { display: flex; border-bottom: 2px solid #1e293b; margin-bottom: 16px; }
  .tab {
    padding: 8px 18px; background: transparent; border: none;
    border-bottom: 2px solid transparent; margin-bottom: -2px;
    color: #64748b; cursor: pointer; font-family: inherit;
    font-size: 12px; font-weight: 500; letter-spacing: 0.3px; transition: all 0.15s;
  }
  .tab:hover { color: #94a3b8; }
  .tab.active { background: #1e293b; color: #f8fafc; border-bottom-color: #3b82f6; font-weight: 700; }
  .panel { display: none; }
  .panel.active { display: block; }
  .paste-help { font-size: 11px; color: #475569; margin-bottom: 8px; line-height: 1.6; }
  textarea {
    width: 100%; min-height: 90px; padding: 10px; resize: vertical;
    background: #0f172a; border: 1px solid #334155; border-radius: 5px;
    color: #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 11px;
    outline: none; transition: border-color 0.15s;
  }
  textarea:focus { border-color: #3b82f6; }
  textarea::placeholder { color: #334155; }
  .btn-row { display: flex; gap: 8px; margin-top: 8px; align-items: center; }
  .btn {
    padding: 6px 16px; border: none; border-radius: 4px; cursor: pointer;
    font-family: inherit; font-size: 11px; font-weight: 600; transition: opacity 0.15s;
  }
  .btn:hover { opacity: 0.85; }
  .btn-primary { background: #1d4ed8; color: #fff; }
  .btn-danger { background: #991b1b; color: #fff; }
  .btn-sm { padding: 4px 10px; font-size: 10px; }
  .msg { font-size: 11px; margin-top: 8px; padding: 6px 10px; border-radius: 4px; }
  .msg-ok { background: #052e16; color: #4ade80; border: 1px solid #166534; }
  .msg-err { background: #1c1917; color: #f87171; border: 1px solid #78350f; }
  .warning {
    background: #1c1917; border: 1px solid #78350f; border-radius: 5px;
    padding: 10px 12px; color: #fbbf24; font-size: 11px; margin-bottom: 14px;
  }
  /* Forecast rows */
  .forecast-row {
    background: #0f172a; border: 1px solid #1e293b; border-radius: 6px;
    padding: 14px; margin-bottom: 10px;
  }
  .forecast-row.close { border-color: #dc2626; }
  .forecast-row.open { border-color: #16a34a; }
  .forecast-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
  .advisor-badge {
    display: inline-block; padding: 3px 10px; border-radius: 3px;
    font-size: 12px; font-weight: 700; letter-spacing: 0.5px;
    background: #1e293b; color: #3b82f6; border: 1px solid #334155;
  }
  .advisor-location { font-size: 11px; color: #94a3b8; }
  .advisor-meta { font-size: 10px; color: #475569; margin-left: auto; }
  .forecast-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
  .field label {
    display: block; font-size: 9px; text-transform: uppercase;
    letter-spacing: 0.5px; color: #64748b; font-weight: 600; margin-bottom: 3px;
  }
  .field input {
    width: 100%; padding: 6px 8px; background: #020617; border: 1px solid #334155;
    border-radius: 3px; color: #e2e8f0; font-family: inherit; font-size: 12px;
    outline: none; transition: border-color 0.15s;
  }
  .field input:focus { border-color: #3b82f6; }
  .forecast-results {
    display: grid; grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 12px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #1e293b;
  }
  .result-item .rlabel { font-size: 9px; text-transform: uppercase; color: #64748b; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 2px; }
  .result-item .rvalue { font-size: 20px; font-weight: 700; color: #e2e8f0; }
  .result-item .rvalue.amber { color: #f59e0b; }
  .badge { display: inline-block; padding: 3px 12px; border-radius: 3px; font-size: 11px; font-weight: 700; letter-spacing: 0.5px; }
  .badge-close { background: #dc2626; color: #fff; }
  .badge-open { background: #16a34a; color: #fff; }
  .decision-note { font-size: 10px; color: #64748b; margin-top: 3px; }
  .copy-btn {
    padding: 4px 10px; background: #1e293b; border: 1px solid #334155;
    color: #94a3b8; border-radius: 3px; cursor: pointer;
    font-family: inherit; font-size: 10px; margin-top: 6px; transition: all 0.15s;
  }
  .copy-btn:hover { border-color: #3b82f6; color: #e2e8f0; }
  /* Advisor cards in stored data tab */
  .advisor-card {
    background: #0f172a; border: 1px solid #1e293b; border-radius: 6px;
    margin-bottom: 10px; overflow: hidden;
  }
  .advisor-card-header {
    display: flex; align-items: center; gap: 10px; padding: 10px 14px;
    cursor: pointer; transition: background 0.15s;
  }
  .advisor-card-header:hover { background: #1e293b; }
  .advisor-card-toggle { color: #475569; font-size: 10px; transition: transform 0.2s; display: inline-block; }
  .advisor-card-toggle.expanded { transform: rotate(90deg); }
  .advisor-card-body { display: none; padding: 0 14px 12px; }
  .advisor-card-body.show { display: block; }
  .history-table { width: 100%; border-collapse: collapse; font-size: 11px; }
  .history-table th {
    text-align: left; padding: 6px 6px; color: #64748b;
    border-bottom: 1px solid #1e293b; font-weight: 600;
    font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;
  }
  .history-table td { padding: 6px; color: #cbd5e1; border-bottom: 1px solid #0f172a; }
  .history-table .green { color: #34d399; font-weight: 700; }
  .history-table .lightblue { color: #93c5fd; }
  .empty-msg { text-align: center; color: #475569; padding: 28px; font-size: 12px; }
  .total-count { font-size: 11px; color: #64748b; margin-bottom: 12px; }
  .delete-section { margin-top: 8px; padding-top: 8px; border-top: 1px solid #1e293b; display: flex; align-items: center; gap: 10px; }
  .delete-section .warn-text { font-size: 10px; color: #64748b; }
  /* Forecast toolbar */
  .forecast-toolbar {
    display: flex; align-items: center; gap: 12px; margin-bottom: 12px;
  }
  .forecast-search-wrap { flex: 1; }
  .forecast-search {
    width: 100%; padding: 7px 10px;
    background: #0f172a; border: 1px solid #334155; border-radius: 4px;
    color: #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 11px;
    outline: none; transition: border-color 0.15s;
  }
  .forecast-search:focus { border-color: #3b82f6; }
  .forecast-search::placeholder { color: #475569; }
  .forecast-sort-wrap { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
  .forecast-sort-label {
    font-size: 10px; color: #64748b; font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .forecast-sort {
    padding: 6px 8px; background: #0f172a; border: 1px solid #334155; border-radius: 4px;
    color: #e2e8f0; font-family: 'JetBrains Mono', monospace; font-size: 11px;
    outline: none; cursor: pointer;
  }
  .forecast-sort:focus { border-color: #3b82f6; }
  /* Forecast collapsible rows */
  .forecast-row .forecast-header {
    cursor: pointer; margin-bottom: 0; transition: background 0.15s; border-radius: 4px;
  }
  .forecast-row .forecast-header:hover { background: #1e293b; }
  .forecast-card-body { display: none; padding-top: 10px; }
  .forecast-card-body.show { display: block; }
  .forecast-row.search-hidden { display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="header-bar"></div>
    <h1>Workshop Trend Calculator</h1>
  </div>
  <div class="subtitle">Paste advisor stats → get closing recommendations</div>

  <div class="tabs">
    <button class="tab active" data-tab="forecast">Forecast</button>
    <button class="tab" data-tab="paste">Paste Data</button>
    <button class="tab" data-tab="data">Stored Data</button>
  </div>

  <div id="panel-paste" class="panel">
    <div class="paste-help">
      Highlight an advisor's stats block from the spreadsheet — include the code in column A (e.g. AVL)
      and all the rows from Date down through % Yes — then paste below.<br>
      The advisor code is auto-detected and used as the identifier. Duplicate workshop dates for the same advisor are overwritten with the latest paste.
    </div>
    <textarea id="paste-area" placeholder="Highlight an advisor's stats block and paste here (Ctrl+V / Cmd+V)..."></textarea>
    <div class="btn-row">
      <button class="btn btn-primary" id="btn-import">Import / Update Advisor</button>
    </div>
    <div id="paste-msg"></div>
  </div>

  <div id="panel-forecast" class="panel active">
    <div id="no-data-warning" class="warning" style="display:none;">
      ⚠ No advisors loaded. Go to "Paste Data" and paste an advisor's stats to get started.
    </div>
    <div id="forecast-toolbar" class="forecast-toolbar" style="display:none;">
      <div class="forecast-search-wrap">
        <input type="text" id="forecast-search" class="forecast-search"
               placeholder="Search by code or city..." autocomplete="off">
      </div>
      <div class="forecast-sort-wrap">
        <label class="forecast-sort-label" for="forecast-sort">Sort:</label>
        <select id="forecast-sort" class="forecast-sort">
          <option value="az" selected>A &rarr; Z</option>
          <option value="za">Z &rarr; A</option>
          <option value="recent">Most Recent Workshop</option>
          <option value="oldest">Least Recent Workshop</option>
        </select>
      </div>
    </div>
    <div id="forecast-rows"></div>
  </div>

  <div id="panel-data" class="panel">
    <div class="total-count" id="total-count"></div>
    <div id="advisor-list"></div>
  </div>
</div>
<script src="popup.js"></script>
</body>
</html>
